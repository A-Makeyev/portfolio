<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/assets/fontawesome/all.min.css">
    <title>Alien Invaders</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400&display=swap');

        :root {
            --crimson-shadow: -1px 1px crimson, -2px 2px black, -3px 3px crimson, -4px 4px black, -5px 5px crimson, -6px 6px black, -7px 7px crimson, -8px 8px black;
            --turquoise-shadow: -1px 1px turquoise, -2px 2px black, -3px 3px turquoise, -4px 4px black, -5px 5px turquoise, -6px 6px black, -7px 7px turquoise, -8px 8px black;
        }

        * {
            cursor: default;
            user-select: none;
            font-family: Roboto  Mono, sans-serif;
        }

        .grid {
            width: 300px; 
            height: 300px;
            display: flex;
            flex-wrap: wrap;
        }

        .grid div {
            width: 20px;
            height: 20px;
        }

        .menu.open,
        .board.open,
        .result.open {
            opacity: 1;
        }

        .menu {
            opacity: 0;
            transition: opacity 1s ease-in;
        }
        
        .board {
            top: 50%;
            left: 50%;
            opacity: 0;
            margin-top: 50px;
            position: absolute;
            text-align: center;
            transition: opacity 1s ease-in;
            transform: translate(-50%, -50%);
        } 

        .result {
            top: 20%;
            left: 50%;
            opacity: 0;
            font-size: 3em;
            position: absolute;
            text-align: center;
            transition: opacity 2s ease-in;
            transform: translate(-50%, -50%);
        }

        #volume {
            cursor: pointer;
            margin-left: 25px;
        }

        .shooter.pilot::before {
            content: attr(emoji);
            font-size: x-large;
        }

        .shooter::before {
            content: 'üõ∏';
            font-size: x-large;
        }

        .invader::before {
            content: 'üëæ';
            font-size: x-large;
        }

        .laser::before {
            content: '‚ö°';
            font-size: x-large;
        }

        .boom::before {
            content: 'üí•';
            font-size: x-large;
        }

        @media (max-width: 575px) {
            .pilot::before,
            .shooter::before,
            .invader::before,
            .laser::before,
            .boom::before {
                font-size: large;
            }
        } 
    </style>
</head>
<body>
    <div class="menu">
        <h3>Score: <span id="score">0</span></h3>
        <h3><i id="volume"></i></h3>
    </div>
    <div class="board">
        <div class="result"></div>
        <div class="grid"><!-- 225 --></div>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(() => {
                document.querySelector('.board').classList.add('open')
                setTimeout(() => {
                    document.querySelector('.menu').classList.add('open')
                }, 1250)
            }, 250) 

            for (let i = 0; i < 225; i++) {
                let div = document.createElement('div')
                document.querySelector('.grid').appendChild(div)
            }

            const laserGun = new Audio('assets/sounds/laser-gun.mp3')
            const alienKill = new Audio('assets/sounds/alien-kill.mp3')
            const explosion = new Audio('assets/sounds/explosion.mp3')
            const victory = new Audio('assets/sounds/victory.mp3')

            const volume = document.getElementById('volume')
            const squares = document.querySelectorAll('.grid div')
            const resultDisplay = document.querySelector('.result')
            const scoreDisplay = document.querySelector('#score')
            let currentShooterIndex = 202
            let currentInvaderIndex = 0
            let invadersShotDown = []
            let direction = 1
            let score = 0
            let width = 15
            let invaderId

            // toggle volume
            volume.classList.add('fa-solid', 'fa-volume-high') // fa-volume-high
            volume.addEventListener('click', () => {
                if (volume.classList.contains('fa-volume-high')) {
                    volume.classList.replace('fa-volume-high', 'fa-volume-xmark')
                    laserGun.muted = true
                    alienKill.muted = true
                    explosion.muted = true
                    victory.muted = true
                } else {
                    volume.classList.replace('fa-volume-xmark', 'fa-volume-high')
                    laserGun.muted = false
                    alienKill.muted = false
                    explosion.muted = false
                    victory.muted = false
                }
            })

            // define invaders
            const invaders = [
                0, 1, 2, 3, 4, 5, 6, 7, 8, 9,
                15, 16, 17, 18, 19, 20, 21, 22, 23, 24,
                30, 31, 32, 33, 34, 35, 36, 37, 38, 39
            ]

            // draw invaders
            invaders.forEach(
                invader => squares[currentInvaderIndex + invader].classList.add('invader')
            )

            // draw shooter
            squares[currentShooterIndex].classList.add('shooter')

            function endGame() {
                document.removeEventListener('keydown', moveShooter)
                document.removeEventListener('keyup', shoot)
            }

            function setPilot(status) {
                let number = Math.floor(Math.random() * 6)

                if (status == 'captured') {
                    switch(number) {
                        case 0:
                            return 'üòµ'
                            break
                        case 1:
                            return 'üò≠'
                            break
                        case 2:
                            return 'ü•µ'
                            break
                        case 3:
                            return 'ü§ï'
                            break
                        case 4:
                            return 'ü•¥'
                            break
                        case 5:
                            return '‚òπÔ∏è'
                            break
                    }
                } else if (status == 'victorious') {
                    switch(number) {
                        case 0:
                            return 'üòé'
                            break
                        case 1:
                            return 'ü§©'
                            break
                        case 2:
                            return 'ü•≥'
                            break
                        case 3:
                            return 'ü•∞'
                            break
                        case 4:
                            return 'ü§™'
                            break  
                        case 5:
                            return 'üòè'
                            break
                    }
                }
            }

            // move shooter
            function moveShooter(event) {
                squares[currentShooterIndex].classList.remove('shooter')
                switch (event.keyCode) {
                    case 37:
                        if (currentShooterIndex % width !== 0) currentShooterIndex -= 1
                        break
                    case 39:
                        if (currentShooterIndex % width < width - 1) currentShooterIndex += 1
                        break
                }
                squares[currentShooterIndex].classList.add('shooter')
            }

            document.addEventListener('keydown', moveShooter)

            // move invaders
            function moveInvaders() {
                const leftEdge = invaders[0] % width === 0
                const rightEdge = invaders[invaders.length - 1] % width === width - 1

                if ((leftEdge && direction === -1) || (rightEdge && direction === 1)) {
                    direction = width
                } else if (direction === width) {
                    direction = leftEdge ? 1 : -1
                }

                for (let x = 0; x <= invaders.length -1; x++) {
                    squares[invaders[x]].classList.remove('invader')
                }

                for (let x = 0; x <= invaders.length -1; x++) {
                    invaders[x] += direction
                }

                for (let x = 0; x <= invaders.length -1; x++) {
                    if (!invadersShotDown.includes(x)) {
                        squares[invaders[x]].classList.add('invader')
                    }
                }

                // lose
                if (squares[currentShooterIndex].classList.contains('invader', 'shooter')) {        
                    squares[currentShooterIndex].classList.add('pilot')
                    document.querySelector('.shooter.pilot').setAttribute('emoji', setPilot('captured'))
                    resultDisplay.style.textShadow = 'var(--crimson-shadow)'
                    resultDisplay.textContent = 'GAME OVER'
                    resultDisplay.classList.add('open')
                    clearInterval(invaderId)
                    explosion.play()
                    endGame()
                }

                for (let x = 0; x <= invaders.length -1; x++) {
                    if (invaders[x] > (squares.length - (width - 1))) {
                        squares[currentShooterIndex].classList.add('pilot')
                        document.querySelector('.shooter.pilot').setAttribute('emoji', setPilot('captured'))
                        resultDisplay.style.textShadow = 'var(--crimson-shadow)'
                        resultDisplay.textContent = 'GAME OVER'
                        resultDisplay.classList.add('open')
                        clearInterval(invaderId)
                        explosion.play()
                        endGame()
                    }
                }

                // win
                if (invadersShotDown.length === invaders.length) {
                    squares[currentShooterIndex].classList.add('pilot')
                    document.querySelector('.shooter.pilot').setAttribute('emoji', setPilot('victorious'))
                    console.log(
                        `%c ${document.querySelector('.shooter.pilot').getAttribute('emoji').repeat(invaders.length)}`,
                        ['font-size: xx-large', 'text-shadow: 2px 2px 2px black'].join(';')
                    )
                    resultDisplay.style.textShadow = 'var(--turquoise-shadow)'
                    resultDisplay.textContent = 'VICTORY'
                    resultDisplay.classList.add('open')
                    clearInterval(invaderId)
                    victory.play()
                    endGame()
                }
            }

            invaderId = setInterval(moveInvaders, 500)

            // shoot
            function shoot(event) {
                let laserId
                let currentLaserIndex = currentShooterIndex

                function moveLaser() {
                    squares[currentLaserIndex].classList.remove('laser')
                    currentLaserIndex -= width
                    squares[currentLaserIndex].classList.add('laser')

                    // destroy invader
                    if (squares[currentLaserIndex].classList.contains('invader')) {
                        squares[currentLaserIndex].classList.remove('invader')
                        squares[currentLaserIndex].classList.remove('laser')
                        squares[currentLaserIndex].classList.add('boom')
                        alienKill.play()

                        setTimeout(() => squares[currentLaserIndex].classList.remove('boom'), 250)
                        clearInterval(laserId)

                        const killedInvaders = invaders.indexOf(currentLaserIndex)
                        invadersShotDown.push(killedInvaders)
                        score++
                        scoreDisplay.textContent = score >= 20 ? `${score}üî•` : score
                    }

                    if (currentLaserIndex < width) {
                        clearInterval(laserId)
                        setTimeout(() => squares[currentLaserIndex].classList.remove('laser'), 100)
                    }
                }

                switch (event.keyCode) {
                    case 32:
                        laserGun.play()
                        laserId = setInterval(moveLaser, 100)
                        break
                }
            }

            document.addEventListener('keyup', shoot)
        })
    </script>
</body>
</html>