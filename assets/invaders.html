<!DOCTYPE html>
<html lang="en" dir="auto">
<head>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400&display=swap');

        .grid {
            width: 300px;
            height: 300px;
            display: flex;
            flex-wrap: wrap;
        }

        .grid div {
            width: 20px;
            height: 20px;
        }

        .board {
            opacity: 0;
        }

        .board.open {
            top: 50%;
            left: 50%;
            opacity: 1;
            position: absolute;
            text-align: center;
            transition: opacity 1s ease-in;
            transform: translate(-50%, -50%);
            font-family: Roboto  Mono, sans-serif;
        } 

        .board h2 {
            margin-bottom: 50px;
        }

        #result {
            top: -5%;
            left: 50%;
            position: absolute;
            text-align: center;
            transform: translate(-50%, -50%);
        }

        .shooter::before {
            content: 'ðŸ›¸';
            font-size: x-large;
        }

        .invader::before {
            content: 'ðŸ‘¾';
            font-size: x-large;
        }

        .laser::before {
            content: 'âš¡';
            font-size: x-large;
        }

        .boom::before {
            content: 'ðŸ’¥';
            font-size: x-large;
        }

        @media (max-width: 575px) {
            .shooter::before {
                content: 'ðŸ›¸';
                font-size: large;
            }

            .invader::before {
                content: 'ðŸ‘¾';
                font-size: large;
            }

            .laser::before {
                content: 'âš¡';
                font-size: large;
            }

            .boom::before {
                content: 'ðŸ’¥';
                font-size: large;
            }
        } 
    </style>
</head>
    <body>
        <div class="board">
            <h2 id="result"></h2>
            <h2>Score: <span id="score"></span></h2>
            <div class="grid"><!-- 225 --></div>
        </div>
        <script>
            document.addEventListener('DOMContentLoaded', () => {
                setTimeout(() => {
                    document.querySelector('.board').classList.add('open')
                }, 500)

                for (let i = 0; i < 225; i++) {
                    let div = document.createElement('div')
                    document.querySelector('.grid').appendChild(div)
                }

                const squares = document.querySelectorAll('.grid div')
                const scoreDisplay = document.querySelector('#score')
                const resultDisplay = document.querySelector('#result')
                let currentShooterIndex = 202
                let currentInvaderIndex = 0
                let invadersShotDown = []
                let direction = 1
                let score = 0
                let width = 15
                let invaderId

                // define invaders
                const invaders = [
                    0, 1, 2, 3, 4, 5, 6, 7, 8, 9,
                    15, 16, 17, 18, 19, 20, 21, 22, 23, 24,
                    30, 31, 32, 33, 34, 35, 36, 37, 38, 39
                ]

                // draw invaders
                invaders.forEach(
                    invader => squares[currentInvaderIndex + invader].classList.add('invader')
                )

                // draw shooter
                squares[currentShooterIndex].classList.add('shooter')

                function destroyShooter() {
                    setTimeout(() => { 
                        document.querySelector('.shooter').remove() 
                    }, 500)
                }

                // move shooter
                function moveShooter(event) {
                    squares[currentShooterIndex].classList.remove('shooter')
                    switch (event.keyCode) {
                        case 37:
                            if (currentShooterIndex % width !== 0) currentShooterIndex -= 1
                            break
                        case 39:
                            if (currentShooterIndex % width < width - 1) currentShooterIndex += 1
                            break
                    }
                    squares[currentShooterIndex].classList.add('shooter')
                }

                document.addEventListener('keydown', moveShooter)

                // move invaders
                function moveInvaders() {
                    const leftEdge = invaders[0] % width === 0
                    const rightEdge = invaders[invaders.length - 1] % width === width - 1

                    if ((leftEdge && direction === -1) || (rightEdge && direction === 1)) {
                        direction = width
                    } else if (direction === width) {
                        direction = leftEdge ? 1 : -1
                    }

                    for (let x = 0; x <= invaders.length -1; x++) {
                        squares[invaders[x]].classList.remove('invader')
                    }

                    for (let x = 0; x <= invaders.length -1; x++) {
                        invaders[x] += direction
                    }

                    for (let x = 0; x <= invaders.length -1; x++) {
                        if (!invadersShotDown.includes(x)) {
                            squares[invaders[x]].classList.add('invader')
                        }
                    }

                    // lose
                    if (squares[currentShooterIndex].classList.contains('invader', 'shooter')) {
                        document.removeEventListener('keydown', moveShooter)
                        squares[currentShooterIndex].classList.add('boom')
                        resultDisplay.textContent = 'GAME OVER'
                        clearInterval(invaderId)
                        destroyShooter()
                    }

                    for (let x = 0; x <= invaders.length -1; x++) {
                        if (invaders[x] > (squares.length - (width - 1))) {
                            document.removeEventListener('keydown', moveShooter)
                            resultDisplay.textContent = 'GAME OVER'
                            clearInterval(invaderId)
                            destroyShooter()
                        }
                    }

                    // win
                    if (invadersShotDown.length === invaders.length) {
                        resultDisplay.textContent = 'VICTORY'
                        clearInterval(invaderId)
                    }
                }

                invaderId = setInterval(moveInvaders, 500)

                // shoot
                function shoot(event) {
                    let laserId
                    let currentLaserIndex = currentShooterIndex

                    function moveLaser() {
                        squares[currentLaserIndex].classList.remove('laser')
                        currentLaserIndex -= width
                        squares[currentLaserIndex].classList.add('laser')

                        // destroy invader
                        if (squares[currentLaserIndex].classList.contains('invader')) {
                            squares[currentLaserIndex].classList.remove('invader')
                            squares[currentLaserIndex].classList.remove('laser')
                            squares[currentLaserIndex].classList.add('boom')

                            setTimeout(() => squares[currentLaserIndex].classList.remove('boom'), 250)
                            clearInterval(laserId)

                            const killedInvaders = invaders.indexOf(currentLaserIndex)
                            invadersShotDown.push(killedInvaders)
                            score++
                            scoreDisplay.textContent = score
                        }

                        if (currentLaserIndex < width) {
                            clearInterval(laserId)
                            setTimeout(() => squares[currentLaserIndex].classList.remove('laser'), 100)
                        }
                    }

                    switch (event.keyCode) {
                        case 32:
                            laserId = setInterval(moveLaser, 100)
                            break
                    }
                }

                document.addEventListener('keyup', shoot)
            })
        </script>
    </body>
</html>